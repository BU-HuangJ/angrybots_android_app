package Messaging;

import java.io.BufferedReader;
<<<<<<< HEAD
import java.io.ByteArrayOutputStream;
=======
>>>>>>> c7e7b9d9440b07ab7c5916a77e1f674f4f260ee7
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
<<<<<<< HEAD
import java.io.OutputStreamWriter;
import java.net.Socket;
import java.net.SocketException;
=======
import java.net.Socket;
>>>>>>> c7e7b9d9440b07ab7c5916a77e1f674f4f260ee7

import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
<<<<<<< HEAD
import com.google.gson.stream.JsonWriter;
=======
>>>>>>> c7e7b9d9440b07ab7c5916a77e1f674f4f260ee7


public abstract class Protocol {

<<<<<<< HEAD
	public JsonObject getFrom(String str){
		JsonParser parse = new JsonParser();
		JsonElement e = parse.parse(str);
		return e.getAsJsonObject();
	}
	public JsonObject read(Socket s) throws IOException, SocketException{
=======
	public JsonObject read(Socket s) throws IOException{
>>>>>>> c7e7b9d9440b07ab7c5916a77e1f674f4f260ee7
		InputStream in = s.getInputStream();
		BufferedReader rdr = new BufferedReader(new InputStreamReader(in));
		String str;
		do{
			str = rdr.readLine();
		}while(str == null);
<<<<<<< HEAD
		
		return getFrom(str);
=======
		JsonParser parse = new JsonParser();
		JsonElement e = parse.parse(str);
		while(e.getAsJsonObject() == null){}
		return e.getAsJsonObject();
>>>>>>> c7e7b9d9440b07ab7c5916a77e1f674f4f260ee7
	}
	
	public void write(Socket sock,String s) throws IOException{
		OutputStream out = sock.getOutputStream();
<<<<<<< HEAD
		out.write((s+"\n").getBytes());
	}
	public void write(Socket sock,Message msg) throws IOException{
		ByteArrayOutputStream output = new ByteArrayOutputStream();
		JsonWriter writer = new JsonWriter(new OutputStreamWriter(output));
		msg.encode(writer);
		write(sock,output.toString());
=======
		out.write((s+'\n').getBytes());
>>>>>>> c7e7b9d9440b07ab7c5916a77e1f674f4f260ee7
	}

}
